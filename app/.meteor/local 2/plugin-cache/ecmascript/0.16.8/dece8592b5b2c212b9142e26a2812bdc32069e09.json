{"metadata":{},"options":{"assumptions":{},"compact":false,"sourceMaps":true,"ast":true,"babelrc":false,"configFile":false,"parserOpts":{"sourceType":"module","sourceFileName":"/Users/phatca/Documents/GitHub/professor-trading-card/app/packages/montiapm:agent/lib/hijack/fs.js","plugins":["*","flow","jsx","asyncGenerators","bigInt","classPrivateMethods","classPrivateProperties","classProperties","doExpressions","dynamicImport","exportDefaultFrom","exportExtensions","exportNamespaceFrom","functionBind","functionSent","importMeta","nullishCoalescingOperator","numericSeparator","objectRestSpread","optionalCatchBinding","optionalChaining",["pipelineOperator",{"proposal":"minimal"}],"throwExpressions","objectRestSpread","objectRestSpread","asyncGenerators","classProperties","classPrivateProperties","jsx","nullishCoalescingOperator","nullishCoalescingOperator","optionalChaining","optionalChaining","optionalCatchBinding","optionalCatchBinding","classProperties","classPrivateProperties","classPrivateMethods","classProperties","classPrivateProperties","asyncGenerators","asyncGenerators","objectRestSpread","objectRestSpread","logicalAssignment"],"allowImportExportEverywhere":true,"allowReturnOutsideFunction":true,"allowUndeclaredExports":true,"strictMode":false},"caller":{"name":"meteor","arch":"os.osx.x86_64"},"sourceFileName":"packages/montiapm:agent/lib/hijack/fs.js","filename":"/Users/phatca/Documents/GitHub/professor-trading-card/app/packages/montiapm:agent/lib/hijack/fs.js","targets":{},"cloneInputAst":true,"browserslistConfigFile":false,"passPerPreset":false,"envName":"development","cwd":"/Users/phatca/Documents/GitHub/professor-trading-card/app","root":"/Users/phatca/Documents/GitHub/professor-trading-card/app","rootMode":"root","plugins":[{"key":"base$0","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"base$0$0","visitor":{"Program":{"enter":[null],"exit":[null]},"_exploded":true,"_verified":true},"options":{"avoidModernSyntax":false,"enforceStrictMode":false,"dynamicImport":true,"generateLetDeclarations":true},"externalDependencies":[]},{"key":"transform-runtime","visitor":{"MemberExpression":{"enter":[null]},"ObjectPattern":{"enter":[null]},"BinaryExpression":{"enter":[null]},"Identifier":{"enter":[null]},"JSXIdentifier":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"version":"7.17.2","helpers":true,"useESModules":false,"corejs":false},"externalDependencies":[]},{"key":"syntax-object-rest-spread","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-object-rest-spread","visitor":{"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-meteor-async-await","visitor":{"AwaitExpression":{"enter":[null]},"_exploded":true,"_verified":true,"FunctionDeclaration":{"exit":[null]},"FunctionExpression":{"exit":[null]},"ObjectMethod":{"exit":[null]},"ArrowFunctionExpression":{"exit":[null]},"ClassMethod":{"exit":[null]},"ClassPrivateMethod":{"exit":[null]}},"options":{"useNativeAsyncAwait":false},"externalDependencies":[]},{"key":"proposal-async-generator-functions","visitor":{"Program":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-class-properties","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{"loose":true},"externalDependencies":[]},{"key":"transform-react-jsx","visitor":{"JSXNamespacedName":{"enter":[null]},"JSXSpreadChild":{"enter":[null]},"Program":{"enter":[null]},"JSXFragment":{"exit":[null]},"JSXElement":{"exit":[null]},"JSXAttribute":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"pragma":"React.createElement","pragmaFrag":"React.Fragment","runtime":"classic","throwIfNamespace":true,"useBuiltIns":false},"externalDependencies":[]},{"key":"transform-react-display-name","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-react-pure-annotations","visitor":{"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-nullish-coalescing-operator","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-nullish-coalescing-operator","visitor":{"LogicalExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-optional-chaining","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-optional-chaining","visitor":{"OptionalCallExpression":{"enter":[null]},"OptionalMemberExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-optional-catch-binding","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-optional-catch-binding","visitor":{"CatchClause":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-class-properties","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-class-properties","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{},"externalDependencies":[]},{"key":"syntax-async-generators","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-async-generator-functions","visitor":{"Program":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-object-rest-spread","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-object-rest-spread","visitor":{"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-logical-assignment-operators","visitor":{"AssignmentExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-literals","visitor":{"NumericLiteral":{"enter":[null]},"StringLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-template-literals","visitor":{"TaggedTemplateExpression":{"enter":[null]},"TemplateLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-parameters","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]}},"options":{},"externalDependencies":[]},{"key":"transform-exponentiation-operator","visitor":{"AssignmentExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]}],"presets":[],"generatorOpts":{"filename":"/Users/phatca/Documents/GitHub/professor-trading-card/app/packages/montiapm:agent/lib/hijack/fs.js","comments":true,"compact":false,"sourceMaps":true,"sourceFileName":"packages/montiapm:agent/lib/hijack/fs.js"}},"code":"module.export({\n  handleErrorEvent: () => handleErrorEvent,\n  wrapFs: () => wrapFs\n});\nlet fs;\nmodule.link(\"fs\", {\n  default(v) {\n    fs = v;\n  }\n}, 0);\nconst Fibers = require('fibers');\nfunction wrapCallback(args, createWrapper) {\n  if (typeof args[args.length - 1] === 'function') {\n    args[args.length - 1] = createWrapper(args[args.length - 1]);\n  }\n}\nfunction handleErrorEvent(eventEmitter, trace, event) {\n  function handler(error) {\n    if (trace && event) {\n      Kadira.tracer.eventEnd(trace, event, {\n        error\n      });\n    }\n\n    // Node throws the error if there are no listeners\n    // We want it to behave as if we are not listening to it\n    if (eventEmitter.listenerCount('error') === 1) {\n      eventEmitter.removeListener('error', handler);\n      eventEmitter.emit('error', error);\n    }\n  }\n  eventEmitter.on('error', handler);\n}\nfunction wrapFs() {\n  // Some npm packages will do fs calls in the\n  // callback of another fs call.\n  // This variable is set with the kadiraInfo while\n  // a callback is run so we can track other fs calls\n  let fsKadiraInfo = null;\n  let originalStat = fs.stat;\n  fs.stat = function () {\n    const kadiraInfo = Kadira._getInfo() || fsKadiraInfo;\n    if (kadiraInfo) {\n      let event = Kadira.tracer.event(kadiraInfo.trace, 'fs', {\n        func: 'stat',\n        path: arguments[0],\n        options: typeof arguments[1] === 'object' ? arguments[1] : undefined\n      });\n      wrapCallback(arguments, cb => function () {\n        Kadira.tracer.eventEnd(kadiraInfo.trace, event);\n        if (!Fibers.current) {\n          fsKadiraInfo = kadiraInfo;\n        }\n        try {\n          cb(...arguments);\n        } finally {\n          fsKadiraInfo = null;\n        }\n      });\n    }\n    return originalStat.apply(fs, arguments);\n  };\n  let originalCreateReadStream = fs.createReadStream;\n  fs.createReadStream = function () {\n    const kadiraInfo = Kadira._getInfo() || fsKadiraInfo;\n    let stream = originalCreateReadStream.apply(this, arguments);\n    if (kadiraInfo) {\n      const event = Kadira.tracer.event(kadiraInfo.trace, 'fs', {\n        func: 'createReadStream',\n        path: arguments[0],\n        options: JSON.stringify(arguments[1])\n      });\n      stream.on('end', () => {\n        Kadira.tracer.eventEnd(kadiraInfo.trace, event);\n      });\n      handleErrorEvent(stream, kadiraInfo.trace, event);\n    }\n    return stream;\n  };\n}","map":{"version":3,"names":["module","export","handleErrorEvent","wrapFs","fs","link","default","v","Fibers","require","wrapCallback","args","createWrapper","length","eventEmitter","trace","event","handler","error","Kadira","tracer","eventEnd","listenerCount","removeListener","emit","on","fsKadiraInfo","originalStat","stat","kadiraInfo","_getInfo","func","path","arguments","options","undefined","cb","current","apply","originalCreateReadStream","createReadStream","stream","JSON","stringify"],"sources":["packages/montiapm:agent/lib/hijack/fs.js"],"sourcesContent":["import fs from 'fs';\nconst Fibers = require('fibers');\n\nfunction wrapCallback (args, createWrapper) {\n  if (typeof args[args.length - 1] === 'function') {\n    args[args.length - 1] = createWrapper(args[args.length - 1]);\n  }\n}\n\nexport function handleErrorEvent (eventEmitter, trace, event) {\n  function handler (error) {\n    if (trace && event) {\n      Kadira.tracer.eventEnd(trace, event, {\n        error\n      });\n    }\n\n    // Node throws the error if there are no listeners\n    // We want it to behave as if we are not listening to it\n    if (eventEmitter.listenerCount('error') === 1) {\n      eventEmitter.removeListener('error', handler);\n      eventEmitter.emit('error', error);\n    }\n  }\n\n  eventEmitter.on('error', handler);\n}\n\nexport function wrapFs () {\n  // Some npm packages will do fs calls in the\n  // callback of another fs call.\n  // This variable is set with the kadiraInfo while\n  // a callback is run so we can track other fs calls\n  let fsKadiraInfo = null;\n\n  let originalStat = fs.stat;\n  fs.stat = function () {\n    const kadiraInfo = Kadira._getInfo() || fsKadiraInfo;\n\n    if (kadiraInfo) {\n      let event = Kadira.tracer.event(kadiraInfo.trace, 'fs', {\n        func: 'stat',\n        path: arguments[0],\n        options: typeof arguments[1] === 'object' ? arguments[1] : undefined\n      });\n\n      wrapCallback(arguments, (cb) => function () {\n        Kadira.tracer.eventEnd(kadiraInfo.trace, event);\n\n        if (!Fibers.current) {\n          fsKadiraInfo = kadiraInfo;\n        }\n\n        try {\n          cb(...arguments);\n        } finally {\n          fsKadiraInfo = null;\n        }\n      });\n    }\n\n    return originalStat.apply(fs, arguments);\n  };\n\n  let originalCreateReadStream = fs.createReadStream;\n  fs.createReadStream = function () {\n    const kadiraInfo = Kadira._getInfo() || fsKadiraInfo;\n    let stream = originalCreateReadStream.apply(this, arguments);\n\n    if (kadiraInfo) {\n      const event = Kadira.tracer.event(kadiraInfo.trace, 'fs', {\n        func: 'createReadStream',\n        path: arguments[0],\n        options: JSON.stringify(arguments[1])\n      });\n\n      stream.on('end', () => {\n        Kadira.tracer.eventEnd(kadiraInfo.trace, event);\n      });\n\n      handleErrorEvent(stream, kadiraInfo.trace, event);\n    }\n\n    return stream;\n  };\n}\n"],"mappings":"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"},"sourceType":"module","externalDependencies":{},"hash":"dece8592b5b2c212b9142e26a2812bdc32069e09"}
