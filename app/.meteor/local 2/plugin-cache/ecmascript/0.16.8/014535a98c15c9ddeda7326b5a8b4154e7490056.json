{"metadata":{},"options":{"assumptions":{},"compact":false,"sourceMaps":true,"ast":true,"babelrc":false,"configFile":false,"parserOpts":{"sourceType":"module","sourceFileName":"/Users/phatca/Documents/GitHub/professor-trading-card/app/packages/montiapm:agent/lib/models/errors.js","plugins":["*","flow","jsx","asyncGenerators","bigInt","classPrivateMethods","classPrivateProperties","classProperties","doExpressions","dynamicImport","exportDefaultFrom","exportExtensions","exportNamespaceFrom","functionBind","functionSent","importMeta","nullishCoalescingOperator","numericSeparator","objectRestSpread","optionalCatchBinding","optionalChaining",["pipelineOperator",{"proposal":"minimal"}],"throwExpressions","objectRestSpread","objectRestSpread","asyncGenerators","classProperties","classPrivateProperties","jsx","nullishCoalescingOperator","nullishCoalescingOperator","optionalChaining","optionalChaining","optionalCatchBinding","optionalCatchBinding","classProperties","classPrivateProperties","classPrivateMethods","classProperties","classPrivateProperties","asyncGenerators","asyncGenerators","objectRestSpread","objectRestSpread","logicalAssignment"],"allowImportExportEverywhere":true,"allowReturnOutsideFunction":true,"allowUndeclaredExports":true,"strictMode":false},"caller":{"name":"meteor","arch":"os.osx.x86_64"},"sourceFileName":"packages/montiapm:agent/lib/models/errors.js","filename":"/Users/phatca/Documents/GitHub/professor-trading-card/app/packages/montiapm:agent/lib/models/errors.js","targets":{},"cloneInputAst":true,"browserslistConfigFile":false,"passPerPreset":false,"envName":"development","cwd":"/Users/phatca/Documents/GitHub/professor-trading-card/app","root":"/Users/phatca/Documents/GitHub/professor-trading-card/app","rootMode":"root","plugins":[{"key":"base$0","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"base$0$0","visitor":{"Program":{"enter":[null],"exit":[null]},"_exploded":true,"_verified":true},"options":{"avoidModernSyntax":false,"enforceStrictMode":false,"dynamicImport":true,"generateLetDeclarations":true},"externalDependencies":[]},{"key":"transform-runtime","visitor":{"MemberExpression":{"enter":[null]},"ObjectPattern":{"enter":[null]},"BinaryExpression":{"enter":[null]},"Identifier":{"enter":[null]},"JSXIdentifier":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"version":"7.17.2","helpers":true,"useESModules":false,"corejs":false},"externalDependencies":[]},{"key":"syntax-object-rest-spread","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-object-rest-spread","visitor":{"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-meteor-async-await","visitor":{"AwaitExpression":{"enter":[null]},"_exploded":true,"_verified":true,"FunctionDeclaration":{"exit":[null]},"FunctionExpression":{"exit":[null]},"ObjectMethod":{"exit":[null]},"ArrowFunctionExpression":{"exit":[null]},"ClassMethod":{"exit":[null]},"ClassPrivateMethod":{"exit":[null]}},"options":{"useNativeAsyncAwait":false},"externalDependencies":[]},{"key":"proposal-async-generator-functions","visitor":{"Program":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-class-properties","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{"loose":true},"externalDependencies":[]},{"key":"transform-react-jsx","visitor":{"JSXNamespacedName":{"enter":[null]},"JSXSpreadChild":{"enter":[null]},"Program":{"enter":[null]},"JSXFragment":{"exit":[null]},"JSXElement":{"exit":[null]},"JSXAttribute":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"pragma":"React.createElement","pragmaFrag":"React.Fragment","runtime":"classic","throwIfNamespace":true,"useBuiltIns":false},"externalDependencies":[]},{"key":"transform-react-display-name","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-react-pure-annotations","visitor":{"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-nullish-coalescing-operator","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-nullish-coalescing-operator","visitor":{"LogicalExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-optional-chaining","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-optional-chaining","visitor":{"OptionalCallExpression":{"enter":[null]},"OptionalMemberExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-optional-catch-binding","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-optional-catch-binding","visitor":{"CatchClause":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-class-properties","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-class-properties","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{},"externalDependencies":[]},{"key":"syntax-async-generators","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-async-generator-functions","visitor":{"Program":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-object-rest-spread","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-object-rest-spread","visitor":{"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-logical-assignment-operators","visitor":{"AssignmentExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-literals","visitor":{"NumericLiteral":{"enter":[null]},"StringLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-template-literals","visitor":{"TaggedTemplateExpression":{"enter":[null]},"TemplateLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-parameters","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]}},"options":{},"externalDependencies":[]},{"key":"transform-exponentiation-operator","visitor":{"AssignmentExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]}],"presets":[],"generatorOpts":{"filename":"/Users/phatca/Documents/GitHub/professor-trading-card/app/packages/montiapm:agent/lib/models/errors.js","comments":true,"compact":false,"sourceMaps":true,"sourceFileName":"packages/montiapm:agent/lib/models/errors.js"}},"code":"module.export({\n  ErrorModel: () => ErrorModel\n});\nlet _;\nmodule.link(\"meteor/underscore\", {\n  _(v) {\n    _ = v;\n  }\n}, 0);\nlet KadiraModel;\nmodule.link(\"./0model\", {\n  KadiraModel(v) {\n    KadiraModel = v;\n  }\n}, 1);\nlet BaseErrorModel;\nmodule.link(\"./base_error\", {\n  BaseErrorModel(v) {\n    BaseErrorModel = v;\n  }\n}, 2);\nlet Ntp;\nmodule.link(\"../ntp\", {\n  Ntp(v) {\n    Ntp = v;\n  }\n}, 3);\nfunction ErrorModel(appId) {\n  BaseErrorModel.call(this);\n  this.appId = appId;\n  this.errors = {};\n  this.startTime = Date.now();\n  this.maxErrors = 10;\n}\nObject.assign(ErrorModel.prototype, KadiraModel.prototype);\nObject.assign(ErrorModel.prototype, BaseErrorModel.prototype);\nErrorModel.prototype.buildPayload = function () {\n  const metrics = _.values(this.errors);\n  this.startTime = Ntp._now();\n  metrics.forEach(function (metric) {\n    metric.startTime = Kadira.syncedDate.syncTime(metric.startTime);\n  });\n  this.errors = {};\n  return {\n    errors: metrics\n  };\n};\nErrorModel.prototype.errorCount = function () {\n  return _.values(this.errors).length;\n};\nErrorModel.prototype.trackError = function (ex, trace) {\n  const key = \"\".concat(trace.type, \":\").concat(ex.message);\n  if (this.errors[key]) {\n    this.errors[key].count++;\n  } else if (this.errorCount() < this.maxErrors) {\n    const errorDef = this._formatError(ex, trace);\n    if (this.applyFilters(errorDef.type, errorDef.name, ex, errorDef.subType)) {\n      this.errors[key] = this._formatError(ex, trace);\n    }\n  }\n};\nErrorModel.prototype._formatError = function (ex, trace) {\n  const time = Date.now();\n  let stack = ex.stack;\n\n  // to get Meteor's Error details\n  if (ex.details) {\n    stack = \"Details: \".concat(ex.details, \"\\r\\n\").concat(stack);\n  }\n\n  // Update trace's error event with the next stack\n  const errorEvent = trace.events && trace.events[trace.events.length - 1];\n  const errorObject = errorEvent && errorEvent[2] && errorEvent[2].error;\n  if (errorObject) {\n    errorObject.stack = stack;\n  }\n  return {\n    appId: this.appId,\n    name: ex.message,\n    type: trace.type,\n    startTime: time,\n    subType: trace.subType || trace.name,\n    trace,\n    stacks: [{\n      stack\n    }],\n    count: 1\n  };\n};","map":{"version":3,"names":["module","export","ErrorModel","_","link","v","KadiraModel","BaseErrorModel","Ntp","appId","call","errors","startTime","Date","now","maxErrors","Object","assign","prototype","buildPayload","metrics","values","_now","forEach","metric","Kadira","syncedDate","syncTime","errorCount","length","trackError","ex","trace","key","concat","type","message","count","errorDef","_formatError","applyFilters","name","subType","time","stack","details","errorEvent","events","errorObject","error","stacks"],"sources":["packages/montiapm:agent/lib/models/errors.js"],"sourcesContent":["import { _ } from 'meteor/underscore';\nimport { KadiraModel } from './0model';\nimport { BaseErrorModel } from './base_error';\nimport { Ntp } from '../ntp';\n\nexport function ErrorModel (appId) {\n  BaseErrorModel.call(this);\n  this.appId = appId;\n  this.errors = {};\n  this.startTime = Date.now();\n  this.maxErrors = 10;\n}\n\nObject.assign(ErrorModel.prototype, KadiraModel.prototype);\nObject.assign(ErrorModel.prototype, BaseErrorModel.prototype);\n\nErrorModel.prototype.buildPayload = function () {\n  const metrics = _.values(this.errors);\n  this.startTime = Ntp._now();\n\n  metrics.forEach(function (metric) {\n    metric.startTime = Kadira.syncedDate.syncTime(metric.startTime);\n  });\n\n  this.errors = {};\n  return {errors: metrics};\n};\n\nErrorModel.prototype.errorCount = function () {\n  return _.values(this.errors).length;\n};\n\nErrorModel.prototype.trackError = function (ex, trace) {\n  const key = `${trace.type}:${ex.message}`;\n  if (this.errors[key]) {\n    this.errors[key].count++;\n  } else if (this.errorCount() < this.maxErrors) {\n    const errorDef = this._formatError(ex, trace);\n    if (this.applyFilters(errorDef.type, errorDef.name, ex, errorDef.subType)) {\n      this.errors[key] = this._formatError(ex, trace);\n    }\n  }\n};\n\nErrorModel.prototype._formatError = function (ex, trace) {\n  const time = Date.now();\n  let stack = ex.stack;\n\n  // to get Meteor's Error details\n  if (ex.details) {\n    stack = `Details: ${ex.details}\\r\\n${stack}`;\n  }\n\n  // Update trace's error event with the next stack\n  const errorEvent = trace.events && trace.events[trace.events.length - 1];\n  const errorObject = errorEvent && errorEvent[2] && errorEvent[2].error;\n\n  if (errorObject) {\n    errorObject.stack = stack;\n  }\n\n  return {\n    appId: this.appId,\n    name: ex.message,\n    type: trace.type,\n    startTime: time,\n    subType: trace.subType || trace.name,\n    trace,\n    stacks: [{stack}],\n    count: 1\n  };\n};\n"],"mappings":"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"},"sourceType":"module","externalDependencies":{},"hash":"014535a98c15c9ddeda7326b5a8b4154e7490056"}
